pkgname=musl
pkgver=riscv
pkgrel=1
arch=('riscv32' 'riscv64')
options=('!buildflags')
source=("https://github.com/michaelforney/musl/archive/$pkgver.tar.gz")

build() {
	unset HOSTCC HOSTCXX

	cd musl-$pkgver
	./configure \
		CROSS_COMPILE=$XTARGET- \
		--prefix=/tools \
		--syslibdir=/tools/lib \
		--build=$XHOST \
		--host=$XTARGET \
		--target=$XTARGET
	make
}

package() {
	unset HOSTCC HOSTCXX

	cd musl-$pkgver
	make DESTDIR=$pkgdir install

	mkdir -p $pkgdir/usr/bin/
	ln -sf ../lib/libc.so $pkgdir/usr/bin/ldd
}
